local UIS = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local Player = game:GetService("Players").LocalPlayer
local TextService = game:GetService("TextService")

local DEFAULT_ZINDEX = 10

local function SafeGetHui()
	if typeof(gethui) == "function" then
		local ok, res = pcall(gethui)
		if ok and res then return res end
	end
	return nil
end

local function CoreParent()
	return SafeGetHui() or Player:FindFirstChild("PlayerGui") or game:GetService("CoreGui")
end

local function Create(class, props, children)
	local obj = Instance.new(class)
	for k,v in pairs(props or {}) do obj[k] = v end
	if obj:IsA("GuiObject") and (not props or props.ZIndex == nil) then
		obj.ZIndex = DEFAULT_ZINDEX
	end
	for _,c in pairs(children or {}) do c.Parent = obj end
	return obj
end

local Library = {}
Library.__index = Library

function Library.SettingManager()
	local Manager = {}
	function Manager:AddToTab(tab)
		tab:Paragraph({Title = "UI Settings", Content = "Manage the interface settings here."})
		tab:Button({Name = "Unload UI", Callback = function()
			local core = CoreParent()
			local gui = core:FindFirstChild("DcusHub_v2.3 UI")
			if gui then gui:Destroy() end
			local notifs = core:FindFirstChild("DcusNotifications")
			if notifs then notifs:Destroy() end
		end})
	end
	return Manager
end

function Library:New(config)
	config = config or {}

	local THEME = {
		MainBg = Color3.fromRGB(10, 10, 12),
		TopBg = Color3.fromRGB(12, 12, 14),
		PanelBg = Color3.fromRGB(14, 14, 16),
		ItemBg = Color3.fromRGB(16, 16, 18),
		ItemHover = Color3.fromRGB(20, 20, 24),
		Stroke = Color3.fromRGB(32, 32, 36),
		StrokeSoft = Color3.fromRGB(40, 40, 46),
		Text = Color3.fromRGB(235, 235, 240),
		TextDim = Color3.fromRGB(165, 165, 175),
		TextMuted = Color3.fromRGB(110, 110, 125),
		Accent = Color3.fromRGB(45, 45, 50),
		AccentSoft = Color3.fromRGB(60, 60, 66),
	}

	self = setmetatable({}, Library)

	self.Gui = Create("ScreenGui", {
		Name = "DcusHub_v2.3 UI",
		ResetOnSpawn = false,
		ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
		Parent = CoreParent()
	})

	self.Main = Create("Frame", {
		Size = UDim2.fromOffset(585, 410),
		Position = UDim2.fromScale(0.5, 0.5),
		AnchorPoint = Vector2.new(0.5, 0.5),
		BackgroundColor3 = THEME.MainBg,
		BorderSizePixel = 0,
		ZIndex = 10,
		Parent = self.Gui
	}, {
		Create("UICorner", {CornerRadius = UDim.new(0, 12)}),
		Create("UIStroke", {Color = THEME.Stroke, Thickness = 1.5})
	})

	if config.BackgroundImage then
		local bgHolder = Create("Frame", {
			Name = "BGHolder",
			Size = UDim2.fromScale(1, 1),
			Position = UDim2.fromScale(0, 0),
			BackgroundTransparency = 1,
			ZIndex = 1,
			Parent = self.Main
		})
		Create("ImageLabel", {
			Name = "BackgroundImage",
			Size = UDim2.fromScale(1, 1),
			Position = UDim2.fromScale(0.5, 0.5),
			AnchorPoint = Vector2.new(0.5, 0.5),
			BackgroundTransparency = 1,
			Image = config.BackgroundImage,
			ImageTransparency = config.BackgroundImageTransparency or 0.7,
			ScaleType = Enum.ScaleType.Crop,
			ZIndex = 1,
			Parent = bgHolder
		})
	end

	self.ReopenLabel = Create("TextButton", {
		Name = "AeroReopen",
		Size = UDim2.new(0, 140, 0, 32),
		Position = UDim2.new(0, 15, 0.5, -16),
		AnchorPoint = Vector2.new(0, 0.5),
		BackgroundColor3 = THEME.PanelBg,
		TextColor3 = THEME.Text,
		Text = "AERO UI - Reopen",
		Font = Enum.Font.GothamBold,
		TextSize = 15,
		Visible = false,
		ZIndex = 9999,
		Parent = self.Gui
	}, {
		Create("UICorner", {CornerRadius = UDim.new(0, 8)}),
		Create("UIStroke", {Color = THEME.StrokeSoft, Thickness = 1.8, Transparency = 0.25})
	})

	self.Top = Create("Frame", {
		Size = UDim2.new(1, 0, 0, 55),
		BackgroundColor3 = THEME.TopBg,
		ZIndex = 11,
		Parent = self.Main
	}, {
		Create("UICorner", {CornerRadius = UDim.new(0, 12)}),
		Create("Frame", {
			Size = UDim2.new(1, 0, 0, 1),
			Position = UDim2.new(0, 0, 1, -1),
			BackgroundColor3 = THEME.Stroke,
			BorderSizePixel = 0,
			ZIndex = 11
		})
	})

	Create("TextLabel", {
		Text = config.Title or "Dcus Hub",
		Font = Enum.Font.GothamBold,
		TextSize = 18,
		TextColor3 = THEME.Text,
		TextXAlignment = Enum.TextXAlignment.Left,
		BackgroundTransparency = 1,
		Position = UDim2.fromOffset(18, 8),
		Size = UDim2.new(0, 200, 0, 30),
		ZIndex = 12,
		Parent = self.Top
	})

	Create("TextLabel", {
		Text = config.Footer or "Premium Interface • v2.3",
		Font = Enum.Font.GothamMedium,
		TextSize = 11,
		TextColor3 = THEME.TextMuted,
		TextXAlignment = Enum.TextXAlignment.Left,
		BackgroundTransparency = 1,
		Size = UDim2.new(0, 200, 0, 20),
		Position = UDim2.fromOffset(18, 28),
		ZIndex = 12,
		Parent = self.Top
	})

	local function createControlButton(text, posX, callback, color)
		local btn = Create("TextButton", {
			Text = text,
			Font = Enum.Font.GothamBold,
			TextSize = 16,
			TextColor3 = color or THEME.TextDim,
			BackgroundTransparency = 1,
			Size = UDim2.fromOffset(32, 32),
			Position = UDim2.new(1, posX, 0, 12),
			ZIndex = 60,
			Parent = self.Main
		})
		btn.MouseButton1Click:Connect(callback)
		return btn
	end

	local MinimizeBtn = createControlButton("−", -80, function() end, Color3.fromRGB(220,180,60))
	createControlButton("×", -45, function() self.Gui:Destroy() end, Color3.fromRGB(220,70,70))

	local IsMinimized = false

	local function minimizeUI()
		if IsMinimized then return end
		IsMinimized = true
		TweenService:Create(self.Main, TweenInfo.new(0.4, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {Position = UDim2.new(0.5, 0, -0.6, 0)}):Play()
		task.delay(0.45, function()
			if IsMinimized then
				self.Main.Visible = false
				self.ReopenLabel.Visible = true
			end
		end)
		self:Notify({Title = "UI Minimized", Content = "Click the left button to reopen", Time = 5})
	end

	local function restoreUI()
		if not IsMinimized then return end
		IsMinimized = false
		self.Main.Position = UDim2.new(0.5, 0, -0.6, 0)
		self.Main.Visible = true
		TweenService:Create(self.Main, TweenInfo.new(0.42, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {Position = UDim2.fromScale(0.5, 0.5)}):Play()
	end

	self.ReopenLabel.MouseButton1Click:Connect(function()
		self.ReopenLabel.Visible = false
		restoreUI()
	end)

	MinimizeBtn.MouseButton1Click:Connect(function()
		if IsMinimized then restoreUI() else minimizeUI() end
	end)

	self.Container = Create("Frame", {
		Size = UDim2.new(1, 0, 1, -55),
		Position = UDim2.fromOffset(0, 55),
		BackgroundTransparency = 1,
		ClipsDescendants = true,
		Visible = true,
		ZIndex = 11,
		Parent = self.Main
	})

	self.Sidebar = Create("Frame", {
		Size = UDim2.new(0, 150, 1, -16),
		Position = UDim2.fromOffset(10, 8),
		BackgroundColor3 = THEME.PanelBg,
		ZIndex = 11,
		Parent = self.Container
	}, {
		Create("UICorner", {CornerRadius = UDim.new(0, 10)}),
		Create("UIStroke", {Color = THEME.Stroke, Thickness = 1})
	})

	self.TabHighlight = Create("Frame", {
		Size = UDim2.new(1, -16, 0, 34),
		Position = UDim2.fromOffset(8, 8),
		BackgroundColor3 = THEME.Accent,
		BackgroundTransparency = 0.82,
		Visible = false,
		ZIndex = 12,
		Parent = self.Sidebar
	}, {
		Create("UICorner", {CornerRadius = UDim.new(0, 8)}),
		Create("UIStroke", {Color = THEME.AccentSoft, Thickness = 1, Transparency = 0.35})
	})

	self.TabHolder = Create("Frame", {
		Size = UDim2.new(1, 0, 1, 0),
		BackgroundTransparency = 1,
		ZIndex = 13,
		Parent = self.Sidebar
	}, {
		Create("UIListLayout", {Padding = UDim.new(0, 5)}),
		Create("UIPadding", {PaddingTop = UDim.new(0, 8), PaddingLeft = UDim.new(0, 8), PaddingRight = UDim.new(0, 8)})
	})

	self.Pages = Create("Frame", {
		Size = UDim2.new(1, -180, 1, -16),
		Position = UDim2.fromOffset(170, 8),
		BackgroundTransparency = 1,
		ZIndex = 11,
		Parent = self.Container
	})

	self._activeSliderUpdate = nil
	self._activeSliderEnd = nil

	UIS.InputChanged:Connect(function(input)
		if self._activeSliderUpdate and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
			self._activeSliderUpdate(input)
		end
	end)

	UIS.InputEnded:Connect(function(input)
		if self._activeSliderUpdate and (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) then
			local endFn = self._activeSliderEnd
			self._activeSliderUpdate = nil
			self._activeSliderEnd = nil
			if endFn then endFn(input) end
		end
	end)

	do
		local dragging, dragStart, startPos
		local function update(input)
			local delta = input.Position - dragStart
			self.Main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
		end
		self.Top.InputBegan:Connect(function(input)
			if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
				dragging = true
				dragStart = input.Position
				startPos = self.Main.Position
				input.Changed:Connect(function()
					if input.UserInputState == Enum.UserInputState.End then dragging = false end
				end)
			end
		end)
		UIS.InputChanged:Connect(function(input)
			if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
				update(input)
			end
		end)
	end

	function self:Notify(config2)
		local title = config2.Title or "Notification"
		local content = config2.Content or ""
		local duration = config2.Time or 5

		local core = CoreParent()
		local NotifGui = core:FindFirstChild("DcusNotifications")
		if not NotifGui then
			NotifGui = Create("ScreenGui", {Name = "DcusNotifications", ResetOnSpawn = false, ZIndexBehavior = Enum.ZIndexBehavior.Sibling, Parent = core})
		end

		local Holder = NotifGui:FindFirstChild("NotifHolder") or Create("Frame", {
			Name = "NotifHolder",
			Parent = NotifGui,
			Size = UDim2.new(0, 300, 1, -20),
			Position = UDim2.new(1, -310, 0, 20),
			BackgroundTransparency = 1
		}, {
			Create("UIListLayout", {VerticalAlignment = Enum.VerticalAlignment.Top, HorizontalAlignment = Enum.HorizontalAlignment.Right, Padding = UDim.new(0, 14), SortOrder = Enum.SortOrder.LayoutOrder})
		})

		local Notif = Create("Frame", {
			Size = UDim2.new(1, 0, 0, 0),
			BackgroundColor3 = THEME.ItemBg,
			BackgroundTransparency = 1,
			Parent = Holder
		}, {
			Create("UICorner", {CornerRadius = UDim.new(0, 10)}),
			Create("UIStroke", {Color = THEME.AccentSoft, Thickness = 1.5, Transparency = 1})
		})

		local TitleLabel = Create("TextLabel", {
			Text = title:upper(),
			Font = Enum.Font.GothamBold,
			TextSize = 14,
			TextColor3 = THEME.TextDim,
			BackgroundTransparency = 1,
			TextTransparency = 1,
			Position = UDim2.fromOffset(16, 12),
			Size = UDim2.new(1, -32, 0, 20),
			TextXAlignment = Enum.TextXAlignment.Left,
			Parent = Notif
		})

		local ContentLabel = Create("TextLabel", {
			Text = content,
			Font = Enum.Font.GothamMedium,
			TextSize = 13,
			TextColor3 = THEME.Text,
			BackgroundTransparency = 1,
			TextTransparency = 1,
			Position = UDim2.fromOffset(16, 36),
			Size = UDim2.new(1, -32, 0, 0),
			TextXAlignment = Enum.TextXAlignment.Left,
			TextYAlignment = Enum.TextYAlignment.Top,
			TextWrapped = true,
			Parent = Notif
		})

		local textSize = TextService:GetTextSize(content, 13, Enum.Font.GothamMedium, Vector2.new(268, math.huge))
		local targetHeight = textSize.Y + 68

		TweenService:Create(Notif, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = UDim2.new(1, 0, 0, targetHeight), BackgroundTransparency = 0}):Play()
		TweenService:Create(Notif.UIStroke, TweenInfo.new(0.5), {Transparency = 0.25}):Play()
		TweenService:Create(TitleLabel, TweenInfo.new(0.6), {TextTransparency = 0}):Play()
		TweenService:Create(ContentLabel, TweenInfo.new(0.7), {TextTransparency = 0}):Play()

		task.delay(duration, function()
			if not Notif or not Notif.Parent then return end
			TweenService:Create(Notif, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.In), {Size = UDim2.new(1, 0, 0, 0), BackgroundTransparency = 1}):Play()
			TweenService:Create(Notif.UIStroke, TweenInfo.new(0.5), {Transparency = 1}):Play()
			TweenService:Create(TitleLabel, TweenInfo.new(0.55), {TextTransparency = 1}):Play()
			TweenService:Create(ContentLabel, TweenInfo.new(0.55), {TextTransparency = 1}):Play()
			task.delay(0.6, function() if Notif and Notif.Parent then Notif:Destroy() end end)
		end)
	end

	function self:NewTab(name)
		local UI = self
		local Tab = {}

		local TabBg = Create("Frame", {
			Size = UDim2.new(1, 0, 0, 34),
			BackgroundColor3 = THEME.ItemBg,
			Parent = UI.TabHolder
		}, {
			Create("UICorner", {CornerRadius = UDim.new(0, 8)}),
			Create("UIStroke", {Color = THEME.Stroke, Thickness = 1})
		})

		local Dot = Create("Frame", {
			Size = UDim2.fromOffset(4, 4),
			Position = UDim2.new(0, 10, 0.5, -2),
			BackgroundColor3 = THEME.TextMuted,
			Parent = TabBg
		}, {Create("UICorner", {CornerRadius = UDim.new(1, 0)})})

		local TabBtn = Create("TextButton", {
			Text = name,
			Font = Enum.Font.GothamMedium,
			TextSize = 13,
			TextColor3 = THEME.TextDim,
			BackgroundTransparency = 1,
			Size = UDim2.fromScale(1, 1),
			Parent = TabBg
		})

		local Page = Create("ScrollingFrame", {
			Size = UDim2.fromScale(1, 1),
			BackgroundTransparency = 1,
			Visible = false,
			ScrollBarThickness = 2,
			ScrollBarImageColor3 = THEME.AccentSoft,
			CanvasSize = UDim2.new(0, 0, 0, 0),
			Parent = UI.Pages
		}, {
			Create("UIListLayout", {Padding = UDim.new(0, 8), SortOrder = Enum.SortOrder.LayoutOrder}),
			Create("UIPadding", {PaddingTop = UDim.new(0, 2), PaddingLeft = UDim.new(0, 2), PaddingRight = UDim.new(0, 8)})
		})

		local UIListLayout = Page:FindFirstChildOfClass("UIListLayout")
		local function UpdateCanvasSize()
			Page.CanvasSize = UDim2.new(0, 0, 0, UIListLayout.AbsoluteContentSize.Y + 15)
		end
		UIListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(UpdateCanvasSize)
		task.spawn(UpdateCanvasSize)

		TabBtn.MouseButton1Click:Connect(function()
			UI.TabHighlight.Visible = true
			local yPos = TabBg.AbsolutePosition.Y - UI.Sidebar.AbsolutePosition.Y
			TweenService:Create(UI.TabHighlight, TweenInfo.new(0.3, Enum.EasingStyle.Quart, Enum.EasingDirection.Out), {Position = UDim2.fromOffset(8, yPos)}):Play()

			for _, p in pairs(UI.Pages:GetChildren()) do
				if p:IsA("ScrollingFrame") then p.Visible = false end
			end

			for _, bg in pairs(UI.TabHolder:GetChildren()) do
				if bg:IsA("Frame") and bg:FindFirstChild("Frame") then
					TweenService:Create(bg:FindFirstChildOfClass("TextButton"), TweenInfo.new(0.2), {TextColor3 = THEME.TextDim}):Play()
					TweenService:Create(bg:FindFirstChild("Frame"), TweenInfo.new(0.2), {BackgroundColor3 = THEME.TextMuted}):Play()
				end
			end

			Page.Visible = true
			TweenService:Create(TabBtn, TweenInfo.new(0.2), {TextColor3 = THEME.Text}):Play()
			TweenService:Create(Dot, TweenInfo.new(0.2), {BackgroundColor3 = THEME.AccentSoft}):Play()
		end)

		function Tab:Button(config3)
			local text = config3.Name or config3.Text or "Button"
			local callback = config3.Callback or function() end

			local BtnBg = Create("Frame", {
				Size = UDim2.new(1, 0, 0, 45),
				BackgroundColor3 = THEME.ItemBg,
				Parent = Page
			}, {
				Create("UICorner", {CornerRadius = UDim.new(0, 8)}),
				Create("UIStroke", {Color = THEME.Stroke, Thickness = 1})
			})

			Create("TextLabel", {
				Text = text,
				Font = Enum.Font.GothamMedium,
				TextSize = 14,
				TextColor3 = THEME.Text,
				BackgroundTransparency = 1,
				Position = UDim2.fromOffset(15, 0),
				Size = UDim2.new(1, -100, 1, 0),
				TextXAlignment = Enum.TextXAlignment.Left,
				Parent = BtnBg
			})

			local RunBadge = Create("Frame", {
				Size = UDim2.fromOffset(45, 22),
				Position = UDim2.new(1, -55, 0.5, -11),
				BackgroundColor3 = THEME.PanelBg,
				Parent = BtnBg
			}, {
				Create("UICorner", {CornerRadius = UDim.new(0, 6)}),
				Create("UIStroke", {Color = THEME.StrokeSoft, Thickness = 1})
			})

			Create("TextLabel", {
				Text = "Run",
				Font = Enum.Font.GothamBold,
				TextSize = 11,
				TextColor3 = THEME.Text,
				BackgroundTransparency = 1,
				Size = UDim2.fromScale(1, 1),
				Parent = RunBadge
			})

			local Hit = Create("TextButton", {Text = "", BackgroundTransparency = 1, Size = UDim2.fromScale(1, 1), ZIndex = BtnBg.ZIndex + 1, Parent = BtnBg})

			Hit.MouseButton1Down:Connect(function()
				TweenService:Create(BtnBg, TweenInfo.new(0.2), {BackgroundColor3 = THEME.ItemHover}):Play()
				TweenService:Create(RunBadge, TweenInfo.new(0.2), {BackgroundColor3 = THEME.AccentSoft}):Play()
			end)

			Hit.MouseButton1Up:Connect(function()
				TweenService:Create(BtnBg, TweenInfo.new(0.3), {BackgroundColor3 = THEME.ItemBg}):Play()
				TweenService:Create(RunBadge, TweenInfo.new(0.3), {BackgroundColor3 = THEME.PanelBg}):Play()
				callback()
			end)
		end

		function Tab:Toggle(config3)
			local text = config3.Name or "Toggle"
			local callback = config3.Callback or function() end
			local state = config3.Default or false

			local TglBg = Create("Frame", {
				Size = UDim2.new(1, 0, 0, 45),
				BackgroundColor3 = THEME.ItemBg,
				Parent = Page
			}, {
				Create("UICorner", {CornerRadius = UDim.new(0, 8)}),
				Create("UIStroke", {Color = THEME.Stroke, Thickness = 1})
			})

			Create("TextLabel", {
				Text = text,
				Font = Enum.Font.GothamMedium,
				TextSize = 14,
				TextColor3 = THEME.Text,
				BackgroundTransparency = 1,
				Position = UDim2.fromOffset(15, 0),
				Size = UDim2.new(1, -70, 1, 0),
				TextXAlignment = Enum.TextXAlignment.Left,
				Parent = TglBg
			})

			local Switch = Create("Frame", {
				Size = UDim2.fromOffset(40, 20),
				Position = UDim2.new(1, -50, 0.5, -10),
				BackgroundColor3 = state and THEME.AccentSoft or THEME.PanelBg,
				Parent = TglBg
			}, {
				Create("UICorner", {CornerRadius = UDim.new(1, 0)}),
				Create("UIStroke", {Color = THEME.StrokeSoft, Thickness = 1})
			})

			local Knob = Create("Frame", {
				Size = UDim2.fromOffset(16, 16),
				Position = state and UDim2.fromOffset(22, 2) or UDim2.fromOffset(2, 2),
				BackgroundColor3 = Color3.new(1, 1, 1),
				Parent = Switch
			}, {Create("UICorner", {CornerRadius = UDim.new(1, 0)})})

			local function updateView(val)
				TweenService:Create(Switch, TweenInfo.new(0.2), {BackgroundColor3 = val and THEME.AccentSoft or THEME.PanelBg}):Play()
				TweenService:Create(Knob, TweenInfo.new(0.2), {Position = val and UDim2.fromOffset(22, 2) or UDim2.fromOffset(2, 2)}):Play()
			end

			local Hit = Create("TextButton", {Text = "", BackgroundTransparency = 1, Size = UDim2.fromScale(1, 1), ZIndex = TglBg.ZIndex + 1, Parent = TglBg})
			Hit.MouseButton1Click:Connect(function()
				state = not state
				updateView(state)
				callback(state)
			end)

			local ToggleFunctions = {}
			function ToggleFunctions:SetValue(val)
				state = val
				updateView(state)
				callback(state)
			end
			return ToggleFunctions
		end

		function Tab:Slider(config3)
			local text = config3.Name or "Slider"
			local min = config3.Min or 0
			local max = config3.Max or 100
			local default = config3.Default or min
			local rounding = config3.Rounding or 0
			local callback = config3.Callback or function() end

			local SliderBg = Create("Frame", {
				Size = UDim2.new(1, 0, 0, 50),
				BackgroundColor3 = THEME.ItemBg,
				Parent = Page
			}, {
				Create("UICorner", {CornerRadius = UDim.new(0, 8)}),
				Create("UIStroke", {Color = THEME.Stroke, Thickness = 1})
			})

			Create("TextLabel", {
				Text = text,
				Font = Enum.Font.GothamMedium,
				TextSize = 14,
				TextColor3 = THEME.Text,
				BackgroundTransparency = 1,
				Position = UDim2.fromOffset(15, 8),
				Size = UDim2.new(1, -100, 0, 20),
				TextXAlignment = Enum.TextXAlignment.Left,
				Parent = SliderBg
			})

			local ValueLabel = Create("TextLabel", {
				Text = tostring(default),
				Font = Enum.Font.GothamBold,
				TextSize = 13,
				TextColor3 = THEME.TextDim,
				BackgroundTransparency = 1,
				Position = UDim2.new(1, -65, 0, 8),
				Size = UDim2.new(0, 50, 0, 20),
				TextXAlignment = Enum.TextXAlignment.Right,
				Parent = SliderBg
			})

			local Tray = Create("Frame", {
				Size = UDim2.new(1, -30, 0, 4),
				Position = UDim2.new(0, 15, 1, -12),
				BackgroundColor3 = THEME.PanelBg,
				Parent = SliderBg
			}, {Create("UICorner", {CornerRadius = UDim.new(1, 0)})})

			local Fill = Create("Frame", {
				Size = UDim2.fromScale((default - min) / (max - min), 1),
				BackgroundColor3 = THEME.AccentSoft,
				Parent = Tray
			}, {Create("UICorner", {CornerRadius = UDim.new(1, 0)})})

			local Knob = Create("Frame", {
				Size = UDim2.fromOffset(8, 8),
				AnchorPoint = Vector2.new(0.5, 0.5),
				Position = UDim2.fromScale((default - min) / (max - min), 0.5),
				BackgroundColor3 = THEME.ItemBg,
				Parent = Tray
			}, {
				Create("UICorner", {CornerRadius = UDim.new(0, 4)}),
				Create("UIStroke", {Color = THEME.AccentSoft, Thickness = 1.5})
			})

			local function Update(input)
				if not input.Position then return end
				local pos = math.clamp((input.Position.X - Tray.AbsolutePosition.X) / Tray.AbsoluteSize.X, 0, 1)
				local rawVal = min + (max - min) * pos
				local val = rounding == 1 and (math.floor(rawVal * 10 + 0.5) / 10) or math.floor(rawVal + 0.5)
				ValueLabel.Text = tostring(val)
				TweenService:Create(Fill, TweenInfo.new(0.1), {Size = UDim2.fromScale(pos, 1)}):Play()
				TweenService:Create(Knob, TweenInfo.new(0.1), {Position = UDim2.fromScale(pos, 0.5)}):Play()
				callback(val)
			end

			local Hit = Create("TextButton", {
				Text = "",
				BackgroundTransparency = 1,
				Size = UDim2.fromScale(1, 1),
				ZIndex = SliderBg.ZIndex + 1,
				Parent = SliderBg
			})

			Hit.InputBegan:Connect(function(input)
				if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
					Update(input)
					UI._activeSliderUpdate = Update
					UI._activeSliderEnd = function() end
				end
			end)
		end

		function Tab:Dropdown(config3)
			local text = config3.Name or "Dropdown"
			local list = config3.List or {}
			local default = config3.Default
			local callback = config3.Callback or function() end
			local expanded = false

			local DropdownBg = Create("Frame", {
				Size = UDim2.new(1, 0, 0, 45),
				BackgroundColor3 = THEME.ItemBg,
				ClipsDescendants = true,
				Parent = Page
			}, {
				Create("UICorner", {CornerRadius = UDim.new(0, 8)}),
				Create("UIStroke", {Color = THEME.Stroke, Thickness = 1})
			})

			local Header = Create("TextButton", {Size = UDim2.new(1, 0, 0, 45), BackgroundTransparency = 1, Text = "", Parent = DropdownBg})

			local TitleLabel = Create("TextLabel", {
				Text = text,
				Font = Enum.Font.GothamMedium,
				TextSize = 14,
				TextColor3 = THEME.Text,
				BackgroundTransparency = 1,
				Position = UDim2.fromOffset(15, 0),
				Size = UDim2.new(1, -50, 1, 0),
				TextXAlignment = Enum.TextXAlignment.Left,
				Parent = Header
			})

			local Arrow = Create("TextLabel", {
				Text = "▼",
				Font = Enum.Font.GothamBold,
				TextSize = 12,
				TextColor3 = THEME.TextMuted,
				BackgroundTransparency = 1,
				Position = UDim2.new(1, -35, 0, 0),
				Size = UDim2.new(0, 25, 1, 0),
				Parent = Header
			})

			local Content = Create("Frame", {
				Size = UDim2.new(1, -20, 0, #list * 32),
				Position = UDim2.fromOffset(10, 45),
				BackgroundTransparency = 1,
				Parent = DropdownBg
			})

			local DropHighlight = Create("Frame", {
				Size = UDim2.new(1, 0, 0, 30),
				BackgroundColor3 = THEME.Accent,
				BackgroundTransparency = 0.7,
				Visible = false,
				ZIndex = DropdownBg.ZIndex + 1,
				Parent = Content
			}, {
				Create("UICorner", {CornerRadius = UDim.new(0, 6)}),
				Create("UIStroke", {Color = THEME.AccentSoft, Thickness = 1, Transparency = 0.35})
			})

			local OptionHolder = Create("Frame", {Size = UDim2.fromScale(1, 1), BackgroundTransparency = 1, ZIndex = DropdownBg.ZIndex + 2, Parent = Content})
			Create("UIListLayout", {Padding = UDim.new(0, 2), SortOrder = Enum.SortOrder.LayoutOrder, Parent = OptionHolder})

			local function Select(v, btn)
				DropHighlight.Visible = true
				local targetY = btn.AbsolutePosition.Y - Content.AbsolutePosition.Y
				TweenService:Create(DropHighlight, TweenInfo.new(0.3, Enum.EasingStyle.Quart, Enum.EasingDirection.Out), {Position = UDim2.fromOffset(0, targetY)}):Play()
				for _, o in pairs(OptionHolder:GetChildren()) do
					if o:IsA("TextButton") then
						TweenService:Create(o, TweenInfo.new(0.2), {TextColor3 = THEME.TextDim}):Play()
					end
				end
				TweenService:Create(btn, TweenInfo.new(0.2), {TextColor3 = THEME.Text}):Play()
				TitleLabel.Text = text .. " : " .. v
				callback(v)
			end

			for i, v in pairs(list) do
				local Opt = Create("TextButton", {
					Text = v,
					Font = Enum.Font.GothamMedium,
					TextSize = 13,
					TextColor3 = THEME.TextDim,
					Size = UDim2.new(1, 0, 0, 30),
					BackgroundTransparency = 1,
					LayoutOrder = i,
					Parent = OptionHolder
				})
				Opt.MouseButton1Click:Connect(function() Select(v, Opt) end)
				if default and v == default then
					task.spawn(function()
						repeat task.wait() until Opt.AbsolutePosition.Y > 0
						Select(v, Opt)
					end)
				end
			end

			Header.MouseButton1Click:Connect(function()
				expanded = not expanded
				TweenService:Create(DropdownBg, TweenInfo.new(0.4, Enum.EasingStyle.Quart), {Size = UDim2.new(1, 0, 0, expanded and (45 + #list * 32 + 10) or 45)}):Play()
				TweenService:Create(Arrow, TweenInfo.new(0.4), {Rotation = expanded and 180 or 0}):Play()
			end)
		end

		function Tab:Label(config3)
			local text = config3.Text or "Label"

			local LabelBg = Create("Frame", {
				Size = UDim2.new(1, 0, 0, 30),
				BackgroundColor3 = THEME.ItemBg,
				BackgroundTransparency = 0.4,
				Parent = Page
			}, {
				Create("UICorner", {CornerRadius = UDim.new(0, 8)}),
				Create("UIStroke", {Color = THEME.Stroke, Thickness = 1, Transparency = 0.5})
			})

			local Text = Create("TextLabel", {
				Text = text,
				Font = Enum.Font.GothamMedium,
				TextSize = 13,
				TextColor3 = THEME.TextDim,
				BackgroundTransparency = 1,
				Position = UDim2.fromOffset(15, 8),
				Size = UDim2.new(1, -30, 0, 0),
				TextXAlignment = Enum.TextXAlignment.Left,
				TextYAlignment = Enum.TextYAlignment.Center,
				TextWrapped = true,
				Parent = LabelBg
			})

			local function Resize()
				local ts = TextService:GetTextSize(Text.Text, Text.TextSize, Text.Font, Vector2.new(Text.AbsoluteSize.X, 10000))
				LabelBg.Size = UDim2.new(1, 0, 0, ts.Y + 16)
				Text.Size = UDim2.new(1, -30, 0, ts.Y)
			end

			Text:GetPropertyChangedSignal("AbsoluteSize"):Connect(Resize)
			task.spawn(Resize)
		end

		function Tab:Paragraph(config3)
			local title = config3.Title or "Paragraph Title"
			local content = config3.Content or "Content description goes here."

			local SectionBg = Create("Frame", {
				Size = UDim2.new(1, 0, 0, 65),
				BackgroundColor3 = THEME.ItemBg,
				Parent = Page
			}, {
				Create("UICorner", {CornerRadius = UDim.new(0, 8)}),
				Create("UIStroke", {Color = THEME.Stroke, Thickness = 1})
			})

			Create("TextLabel", {
				Text = title:upper(),
				Font = Enum.Font.GothamBold,
				TextSize = 12,
				TextColor3 = THEME.TextDim,
				BackgroundTransparency = 1,
				Position = UDim2.fromOffset(15, 8),
				Size = UDim2.new(1, -30, 0, 20),
				TextXAlignment = Enum.TextXAlignment.Left,
				Parent = SectionBg
			})

			Create("Frame", {
				Size = UDim2.new(1, -30, 0, 1),
				Position = UDim2.fromOffset(15, 30),
				BackgroundColor3 = THEME.Stroke,
				BorderSizePixel = 0,
				Parent = SectionBg
			})

			local Desc = Create("TextLabel", {
				Text = content,
				Font = Enum.Font.GothamMedium,
				TextSize = 13,
				TextColor3 = THEME.TextDim,
				BackgroundTransparency = 1,
				Position = UDim2.fromOffset(15, 38),
				Size = UDim2.new(1, -30, 0, 0),
				TextXAlignment = Enum.TextXAlignment.Left,
				TextYAlignment = Enum.TextYAlignment.Top,
				TextWrapped = true,
				Parent = SectionBg
			})

			local function Resize()
				local ts = TextService:GetTextSize(Desc.Text, Desc.TextSize, Desc.Font, Vector2.new(Desc.AbsoluteSize.X, 10000))
				SectionBg.Size = UDim2.new(1, 0, 0, ts.Y + 50)
				Desc.Size = UDim2.new(1, -30, 0, ts.Y)
			end

			Desc:GetPropertyChangedSignal("AbsoluteSize"):Connect(Resize)
			task.spawn(Resize)
		end

		function Tab:Keybind(config3)
			local text = config3.Name or "Keybind"
			local default = config3.Default or Enum.KeyCode.E
			local callback = config3.Callback or function() end
			local onChange = config3.OnChange or function() end
			local listening = false

			local BindBg = Create("Frame", {
				Size = UDim2.new(1, 0, 0, 40),
				BackgroundColor3 = THEME.ItemBg,
				Parent = Page
			}, {
				Create("UICorner", {CornerRadius = UDim.new(0, 8)}),
				Create("UIStroke", {Color = THEME.Stroke, Thickness = 1})
			})

			Create("TextLabel", {
				Text = text,
				Font = Enum.Font.GothamMedium,
				TextSize = 13,
				TextColor3 = THEME.Text,
				BackgroundTransparency = 1,
				Position = UDim2.fromOffset(15, 0),
				Size = UDim2.new(1, -85, 1, 0),
				TextXAlignment = Enum.TextXAlignment.Left,
				Parent = BindBg
			})

			local BindDisplay = Create("Frame", {
				Size = UDim2.fromOffset(60, 24),
				Position = UDim2.new(1, -75, 0.5, -12),
				BackgroundColor3 = THEME.PanelBg,
				Parent = BindBg
			}, {
				Create("UICorner", {CornerRadius = UDim.new(0, 6)}),
				Create("UIStroke", {Color = THEME.StrokeSoft, Thickness = 1})
			})

			local BindText = Create("TextLabel", {
				Text = default.Name,
				Font = Enum.Font.GothamBold,
				TextSize = 11,
				TextColor3 = THEME.Text,
				BackgroundTransparency = 1,
				Size = UDim2.fromScale(1, 1),
				Parent = BindDisplay
			})

			local Hit = Create("TextButton", {Text = "", BackgroundTransparency = 1, Size = UDim2.fromScale(1, 1), ZIndex = BindBg.ZIndex + 1, Parent = BindBg})

			Hit.MouseButton1Click:Connect(function()
				listening = true
				BindText.Text = "..."
				local stroke = BindDisplay:FindFirstChildOfClass("UIStroke")
				if stroke then TweenService:Create(stroke, TweenInfo.new(0.2), {Color = THEME.AccentSoft}):Play() end
			end)

			UIS.InputBegan:Connect(function(input, gpe)
				if gpe then return end
				if listening and input.UserInputType == Enum.UserInputType.Keyboard then
					listening = false
					default = input.KeyCode
					BindText.Text = input.KeyCode.Name
					local stroke = BindDisplay:FindFirstChildOfClass("UIStroke")
					if stroke then TweenService:Create(stroke, TweenInfo.new(0.2), {Color = THEME.StrokeSoft}):Play() end
					onChange(input.KeyCode)
				elseif not listening and input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode == default then
					local t = TweenService:Create(BindDisplay, TweenInfo.new(0.1), {BackgroundColor3 = THEME.AccentSoft})
					t:Play()
					t.Completed:Connect(function()
						TweenService:Create(BindDisplay, TweenInfo.new(0.2), {BackgroundColor3 = THEME.PanelBg}):Play()
					end)
					callback()
				end
			end)
		end

		function Tab:Textbox(config3)
			local text = config3.Name or "Textbox"
			local placeholder = config3.Placeholder or "Enter..."
			local callback = config3.Callback or function() end

			local BoxBg = Create("Frame", {
				Size = UDim2.new(1, 0, 0, 40),
				BackgroundColor3 = THEME.ItemBg,
				Parent = Page
			}, {
				Create("UICorner", {CornerRadius = UDim.new(0, 8)}),
				Create("UIStroke", {Color = THEME.Stroke, Thickness = 1})
			})

			local TitleLabel = Create("TextLabel", {
				Text = text,
				Font = Enum.Font.GothamMedium,
				TextSize = 13,
				TextColor3 = THEME.Text,
				BackgroundTransparency = 1,
				Position = UDim2.fromOffset(15, 0),
				Size = UDim2.new(1, -80, 1, 0),
				TextXAlignment = Enum.TextXAlignment.Left,
				Parent = BoxBg
			})

			local InputHolder = Create("Frame", {
				Size = UDim2.new(0, 60, 0, 26),
				Position = UDim2.new(1, -75, 0.5, -13),
				BackgroundColor3 = THEME.MainBg,
				ClipsDescendants = true,
				Parent = BoxBg
			}, {
				Create("UICorner", {CornerRadius = UDim.new(0, 6)}),
				Create("UIStroke", {Color = THEME.StrokeSoft, Thickness = 1})
			})

			local Input = Create("TextBox", {
				Text = "",
				PlaceholderText = placeholder,
				Font = Enum.Font.GothamMedium,
				TextSize = 11,
				TextColor3 = THEME.Text,
				BackgroundTransparency = 1,
				Size = UDim2.new(1, -10, 1, 0),
				Position = UDim2.fromOffset(5, 0),
				TextXAlignment = Enum.TextXAlignment.Center,
				Parent = InputHolder
			})

			Input.Focused:Connect(function()
				TweenService:Create(InputHolder, TweenInfo.new(0.4, Enum.EasingStyle.Quart, Enum.EasingDirection.Out), {Size = UDim2.new(0, 180, 0, 26), Position = UDim2.new(1, -195, 0.5, -13)}):Play()
				TweenService:Create(InputHolder:FindFirstChildOfClass("UIStroke"), TweenInfo.new(0.4), {Color = THEME.AccentSoft}):Play()
				TweenService:Create(TitleLabel, TweenInfo.new(0.4), {TextTransparency = 0.5}):Play()
			end)

			Input.FocusLost:Connect(function(enterPressed)
				TweenService:Create(InputHolder, TweenInfo.new(0.4, Enum.EasingStyle.Quart, Enum.EasingDirection.Out), {Size = UDim2.new(0, 60, 0, 26), Position = UDim2.new(1, -75, 0.5, -13)}):Play()
				TweenService:Create(InputHolder:FindFirstChildOfClass("UIStroke"), TweenInfo.new(0.4), {Color = THEME.StrokeSoft}):Play()
				TweenService:Create(TitleLabel, TweenInfo.new(0.4), {TextTransparency = 0}):Play()
				callback(Input.Text, enterPressed)
			end)
		end

		return Tab
	end

	return self
end

return Library
